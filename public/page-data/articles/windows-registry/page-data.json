{"componentChunkName":"component---src-templates-blog-post-js","path":"/articles/windows-registry/","result":{"pageContext":{"post":{"fields":{"slug":"/windows-registry"},"excerpt":"The Root Keys HKEY_CLASSES_ROOT (HKCR)HKEY_CURRENT_USER (HKCU)HKEY_LOCAL_MACHINE (HKLM)HKEY_USERS (HKU)HKEY_CURRENT_CONFIG (HKCC)\nQue…","frontmatter":{"date":"13th July 2022 ","title":"Windows Registry","description":"The Registry has been a part of Windows since Windows 3.1. Simply put, it's a database that stores Windows and programme settings. Some of those settings are quite complex and aren't meant for humans to alter or comprehend; others are simple and can be safely tweaked.","tags":"registry","posttype":"article"},"body":"\n# Registry\n\n### The Root Keys\n\n- HKEY_CLASSES_ROOT (HKCR)\n- HKEY_CURRENT_USER (HKCU)\n- HKEY_LOCAL_MACHINE (HKLM)\n- HKEY_USERS (HKU)\n- HKEY_CURRENT_CONFIG (HKCC)\n\n### Query Registry via Command Line\n\nList all\n\n```\nreg query <hive>\n```\n\nUse `/f` to search\n\n```\nreg query HKLM /f password\n```\n\nAdd `/s` to make the search recursive.\n\n```\nreg query HKLM  /s /f password\n```\n\nUse `/d` to only search in the data only.\n\n```\nreg query HKLM /d /s /f password\n```\n\n### Examples\n\nInstalled Programs\n\n```\nreg query HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall >> installed_programs.txt\n```\n\nRecursively loop through all registry keys.\n\n```\nreg query HKEY_LOCAL_MACHINE\\Software\\ \\s\n```\n\nServices\n\n```\nreg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\ >> installed_services.txt\n```\n\nVNC Stored\n\n```\nreg query \"HKCU\\Software\\ORL\\WinVNC3\\Password\"\nreg query \"HKCU\\Software\\ORL\\WinVNC4\\Password\"\n```\n\nWindows Autologin\n\n```\nreg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon\"\n```\n\nSNMP Parameters\n\n```\nreg query \"HKLM\\SYSTEM\\Current\\ControlSet\\Services\\SNMP\"\n```\n\nRun-on Boot\n\n```\nreg query \"\\\\DC02\\HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\"\nreg query \"\\\\DC02\\HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\nreg query \"\\\\DC02\\HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\"\n```\n\nVNC Password\n\n```\nreg query \"\\\\DC02\\HKLM\\SOFTWARE\\RealVNC\\WinVNC4 /v password\"\n```\n\nPutty Password\n\n```\nreg query \"\\\\DC02\\HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\"\n```\n\nPutty clear text proxy credentials:\n\n```\nreg query \"HKCU\\Software\\<user>\\PuTTY\\Sessions\"\n```\n\nCheck notification packages\n\n```\nreg query \"\\\\DC02\\HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\" /v \"Notification Packages\"\n```\n\nStarting with Windows 2000-based computers, the machine account password automatically changes every 30 days. Check if this has been disabled\n\n```\nreg query \"\\\\DC02\\HKLM\\System\\CurrentControlSet\\Services\\Netlogon\\Parameters\" /v \"DisablePasswordChange\"\n```\n\nSearch for passwords inside the registry\n\n```\nreg query HKLM /f password /t REG_SZ /s\nreg query HKCU /f password /t REG_SZ /s\nreg query HKLM /s | findstr /i password > temp.txt\nreg query HKCU /s | findstr /i password > temp.txt\n```\n\nCheck autologon\n\n```\nreg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon\"\n```\n\nSNMP Settings\n\n```\nreg query \"HKLM\\SYSTEM\\Current\\ControlSet\\Services\\SNMP\"\n```\n\nIf BOTH registry values are set to 1, we can install a malicious MSI file.\n\n```\nreg query \"HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer\" /v \"AlwaysInstallElevated\"\nreg query \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer\" /v \"AlwaysInstallElevated\"\n```\n\nView the Name of the Domain Controller\n\n```\nreg query \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\History\" /v DCName\n```\n\nCheck Browser Proxy Settings\n\n```\nreg query \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Wpad\"\n```\n\nInternet Explorer History\n\n```\nreg query \"HKCU\\Software\\Microsoft\\Internet Explorer\\TypedURLs\"\n```\n\nCheck physically attached hardware.\n\n```\nreg query \"HKLM\\System\\MountedDevices\"\n```\n\nCheck recent apps\n\n```\nreg query \"HKLM\\Microsoft\\Currentversion\\Search\\RecentApps\"\n```\n\nRemotely query the registry for the last logged in user.\n\n```\nreg query \"\\\\computername\\HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\WinLogon\"\n```\n\n### Terminal Server Service\n\nCheck if enabled\n\n```\nreg query \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\" /v \"fDenyTSConnections\"\n```\n\nEnable remote desktop.\n\n```\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /t REG_DWORD /d 0 /f\n```\n\nDisable remote assistance\n\n```\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fAllowToGetHelp /t REG_DWORD /d 1 /f\n```\n\nThis setting enforces the deleting of Remote Desktop Services. Command checks if set.\n\n```\nreg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v \"DeleteTempDirsOnExit\"\n```"},"prev":null,"next":{"fields":{"slug":"/find-interesting-files"},"excerpt":"Find SUID files find / -perm -4000 -type f 2>/dev/null\n\n\nFind SUID files owned by root\n\nfind / -uid 0 -perm -4000 -type f 2>/dev/null\n\n\nFind…","frontmatter":{"date":"29th June 2022 ","title":"Find Interesting Files","description":"A significant part of our job when searching around a target system is to look for interesting files.  Whether we have a need to look for SSH keys, Bash History files or database backups the commands typically all follow the same syntax. This article will look at using basic Linux commands to find and discover files.","tags":"enumeration, linux","posttype":"article"},"body":"\n# Finding Interesting Files\n\nFind SUID files\n\n```bash\nfind / -perm -4000 -type f 2>/dev/null\n```\n\nFind SUID files owned by root\n\n```bash\nfind / -uid 0 -perm -4000 -type f 2>/dev/null\n```\n\nFind GUID files\n\n```bash\nfind / -perm -2000 -type f 2>/dev/null\n```\n\nFind world-writeable files\n\n```bash\nfind / -perm -2 -type f 2>/dev/null\n```\n\nFind world-writeable files excluding those in /proc\n\n```bash\nfind / ! -path \"*/proc/*\" -perm -2 -type f -print 2>/dev/null\n```\n\nFind word-writeable directories\n\n```bash\nfind / -perm -2 -type d 2>/dev/null\n```\n\nFind rhost config files\n\n```bash\nfind /home –name *.rhosts -print 2>/dev/null\n```\n\nFind *.plan files, list permissions and cat the file contents\n\n```bash\nfind /home -iname *.plan -exec ls -la {} ; -exec cat {} 2>/dev/null ;\n```\n\nFind hosts.equiv, list permissions and cat the file contents\n\n```bash\nfind /etc -iname hosts.equiv -exec ls -la {} 2>/dev/null ; -exec cat {} 2>/dev/null ;\n```\n\nSee if you can access other user directories to find interesting files\n\n```bash\nls -ahlR /root/\n```\n\nShow the current users’ command history\n\n```bash\ncat ~/.bash_history\n```\n\nShow the current users’ various history files\n\n```bash\nls -la ~/.*_history\n```\n\nCan we read root’s history files\n\n```bash\nls -la /root/.*_history\n```\n\nCheck for interesting ssh files in the current users’ directory\n\n```bash\nls -la ~/.ssh/\n```\n\nFind SSH keys/host information\n\n```bash\nfind / -name \"id_dsa*\" -o -name \"id_rsa*\" -o -name \"known_hosts\" -o -name \"authorized_hosts\" -o -name \"authorized_keys\" 2>/dev/null |xargs -r ls -la\n```\n\nCheck Configuration of inetd services\n\n```bash\nls -la /usr/sbin/in.*\n```\n\nCheck log files for keywords (‘pass’ in this example) and show positive matches\n\n```bash\ngrep -l -i pass /var/log/*.log 2>/dev/null\n```\n\nList files in specified directory (/var/log)\n\n```bash\nfind /var/log -type f -exec ls -la {} ; 2>/dev/null\n```\n\nList .log files in specified directory (/var/log)\n\n```bash\nfind /var/log -name *.log -type f -exec ls -la {} ; 2>/dev/null\n```\n\nList .conf files in /etc (recursive 1 level)\n\n```bash\nfind /etc/ -maxdepth 1 -name *.conf -type f -exec ls -la {} ; 2>/dev/null\n```\n\nAs above\n\n```bash\nls -la /etc/*.conf\n```\n\nFind .conf files (recursive 4 levels) and output line number where the word ‘password’ is located\n\n```bash\nfind / -maxdepth 4 -name *.conf -type f -exec grep -Hn password {} ; 2>/dev/null\n```\n\nList open files (output will depend on account privileges)\n\n```bash\nlsof -i -n\n```\n\nCan we read roots mail\n\n```bash\nhead /var/mail/root\n```"}}},"staticQueryHashes":["310218920"],"slicesMap":{}}